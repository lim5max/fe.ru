<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>DNS-серверы - FE Платформа</title>
    <link href="../styles.css" rel="stylesheet" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <!-- Header Web Component -->
    <script src="../components/fe-header.js"></script>
  </head>
  <body class="bg-base-surface-1 font-sans">
    <!-- Main Container / Главный контейнер -->
    <div class="min-h-screen flex">
      <!-- Sidebar / Боковая панель -->
      <div id="sidebar-container" class="hidden lg:block"></div>

      <!-- Main Content Area / Основная область контента -->
      <div class="flex flex-col grow w-full">
        <!-- Header / Заголовок с кнопкой назад -->
        <fe-header
          back-link="./domain-settings.html"
          back-text="Настройки домена"
        ></fe-header>

        <!-- Page Content / Содержимое страницы -->
        <div
          class="bg-base-surface-1 flex flex-col gap-2.5 grow pt-17 px-6 lg:px-15 w-full lg:pl-[300px]"
        >
          <div class="max-w-[880px] w-full mx-auto">
            <!-- Domain Header / Шапка домена -->
            <div class="flex items-center gap-4 mb-10">
              <!-- Connect Icon / Иконка подключения -->
              <div
                class="bg-base-surface-2 rounded-9 p-7 flex items-center justify-center flex-shrink-0"
              >
                <img
                  src="../public/icons/connect.svg"
                  alt="DNS"
                  class="w-13 h-13"
                />
              </div>

              <!-- Domain Info / Информация о домене -->
              <div class="flex flex-col">
                <h2 class="text-base-medium text-text-dark-secondary">
                  testdomain.com
                </h2>
                <h1 class="text-xl-semibold text-text-dark-primary">
                  DNS-серверы
                </h1>
              </div>
            </div>

            <!-- NS Servers Section / Секция NS-серверов -->
            <div class="flex flex-col gap-6">
              <!-- Section Header / Заголовок секции -->
              <h2 class="text-xl-semibold text-text-dark-primary">
                Список NS-серверов
              </h2>

              <!-- NS Servers List / Список NS-серверов -->
              <div id="ns-servers-container" class="flex flex-col gap-6">
                <!-- NS Server Item / Элемент NS-сервера -->
                <div class="ns-server-item flex flex-col lg:flex-row gap-8">
                  <div class="flex flex-col gap-3 w-full lg:w-[264px]">
                    <label class="text-lg-regular text-text-dark-secondary">
                      NS-сервер
                    </label>
                    <input
                      type="text"
                      class="ns-server-input bg-base-surface-2 border border-base-border rounded-6 px-4 h-14 text-lg-medium text-text-dark-secondary placeholder:text-text-dark-tertiary focus:border-state-brand-active focus:outline-none transition-colors"
                      value="ns1.fe.ru"
                      readonly
                    />
                  </div>
                  <div class="flex flex-col gap-3 w-full lg:w-[264px]">
                    <label class="text-lg-regular text-text-dark-secondary">
                      IP-адрес
                    </label>
                    <input
                      type="text"
                      class="ip-input bg-base-surface-2 border border-base-border rounded-6 px-4 h-14 text-lg-medium text-text-dark-secondary placeholder:text-text-dark-tertiary focus:border-state-brand-active focus:outline-none transition-colors"
                      placeholder="Text"
                    />
                  </div>
                </div>

                <!-- NS Server Item 2 -->
                <div class="ns-server-item flex flex-col lg:flex-row gap-8">
                  <div class="flex flex-col gap-3 w-full lg:w-[264px]">
                    <label class="text-lg-regular text-text-dark-secondary">
                      NS-сервер
                    </label>
                    <input
                      type="text"
                      class="ns-server-input bg-base-surface-2 border border-base-border rounded-6 px-4 h-14 text-lg-medium text-text-dark-secondary placeholder:text-text-dark-tertiary focus:border-state-brand-active focus:outline-none transition-colors"
                      value="ns1.fe.ru"
                      readonly
                    />
                  </div>
                  <div class="flex flex-col gap-3 w-full lg:w-[264px]">
                    <label class="text-lg-regular text-text-dark-secondary">
                      IP-адрес
                    </label>
                    <input
                      type="text"
                      class="ip-input bg-base-surface-2 border border-base-border rounded-6 px-4 h-14 text-lg-medium text-text-dark-secondary placeholder:text-text-dark-tertiary focus:border-state-brand-active focus:outline-none transition-colors"
                      placeholder="Text"
                    />
                  </div>
                </div>

                <!-- NS Server Item 3 -->
                <div class="ns-server-item flex flex-col lg:flex-row gap-8">
                  <div class="flex flex-col gap-3 w-full lg:w-[264px]">
                    <label class="text-lg-regular text-text-dark-secondary">
                      NS-сервер
                    </label>
                    <input
                      type="text"
                      class="ns-server-input bg-base-surface-2 border border-base-border rounded-6 px-4 h-14 text-lg-medium text-text-dark-secondary placeholder:text-text-dark-tertiary focus:border-state-brand-active focus:outline-none transition-colors"
                      value="ns1.fe.ru"
                      readonly
                    />
                  </div>
                  <div class="flex flex-col gap-3 w-full lg:w-[264px]">
                    <label class="text-lg-regular text-text-dark-secondary">
                      IP-адрес
                    </label>
                    <input
                      type="text"
                      class="ip-input bg-base-surface-2 border border-base-border rounded-6 px-4 h-14 text-lg-medium text-text-dark-secondary placeholder:text-text-dark-tertiary focus:border-state-brand-active focus:outline-none transition-colors"
                      placeholder="Text"
                    />
                  </div>
                </div>

                <!-- NS Server Item 4 -->
                <div class="ns-server-item flex flex-col lg:flex-row gap-8">
                  <div class="flex flex-col gap-3 w-full lg:w-[264px]">
                    <label class="text-lg-regular text-text-dark-secondary">
                      NS-сервер
                    </label>
                    <input
                      type="text"
                      class="ns-server-input bg-base-surface-2 border border-base-border rounded-6 px-4 h-14 text-lg-medium text-text-dark-secondary placeholder:text-text-dark-tertiary focus:border-state-brand-active focus:outline-none transition-colors"
                      value="ns1.fe.ru"
                      readonly
                    />
                  </div>
                  <div class="flex flex-col gap-3 w-full lg:w-[264px]">
                    <label class="text-lg-regular text-text-dark-secondary">
                      IP-адрес
                    </label>
                    <input
                      type="text"
                      class="ip-input bg-base-surface-2 border border-base-border rounded-6 px-4 h-14 text-lg-medium text-text-dark-secondary placeholder:text-text-dark-tertiary focus:border-state-brand-active focus:outline-none transition-colors"
                      placeholder="Text"
                    />
                  </div>
                </div>

                <!-- Add New Server Input / Инпут добавления нового сервера -->
                <div
                  id="new-server-container"
                  class="new-server-item flex flex-col lg:flex-row gap-8"
                >
                  <div class="flex flex-col gap-3 w-full lg:w-[264px]">
                    <label class="text-lg-regular text-text-dark-secondary">
                      NS-сервер
                    </label>
                    <input
                      type="text"
                      id="new-server-input"
                      class="bg-base-surface-2 border border-base-border rounded-6 px-4 h-14 text-lg-medium text-text-dark-secondary placeholder:text-text-dark-tertiary focus:border-state-brand-active focus:outline-none transition-colors"
                      placeholder="Добавьте новую запись"
                    />
                  </div>
                  <div
                    id="new-ip-container"
                    class="flex-col gap-3 w-full lg:w-[264px] hidden"
                  >
                    <label class="text-lg-regular text-text-dark-secondary">
                      IP-адрес
                    </label>
                    <input
                      type="text"
                      id="new-ip-input"
                      class="bg-base-surface-2 border border-base-border rounded-6 px-4 h-14 text-lg-medium text-text-dark-secondary placeholder:text-text-dark-tertiary focus:border-state-brand-active focus:outline-none transition-colors"
                      placeholder="Text"
                    />
                  </div>
                </div>
              </div>

              <!-- Save Button / Кнопка сохранения -->
              <button
                id="save-btn"
                class="bg-base-surface-2 text-text-dark-tertiary rounded-6 px-6 h-15 text-base-semibold transition-colors cursor-not-allowed w-full lg:w-[264px]"
                disabled
              >
                Сохранить
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- JavaScript / Скрипты -->
    <script>
      // Load Components / Загрузка компонентов
      async function loadComponent(containerId, componentPath) {
        try {
          const response = await fetch(componentPath);
          const html = await response.text();
          document.getElementById(containerId).innerHTML = html;
        } catch (error) {
          console.error(`Error loading component ${componentPath}:`, error);
        }
      }

      // Initialize Components / Инициализация компонентов
      document.addEventListener("DOMContentLoaded", async function () {
        await loadComponent("sidebar-container", "../components/sidebar.html");
        initNewServerInput();
        initChangeDetection();
      });

      // New Server Input Logic / Логика инпута нового сервера
      function initNewServerInput() {
        const newServerInput = document.getElementById("new-server-input");
        const newIpContainer = document.getElementById("new-ip-container");
        const container = document.getElementById("ns-servers-container");

        newServerInput.addEventListener("input", (e) => {
          const value = e.target.value.trim();

          if (value.length > 0) {
            // Показываем поле IP-адреса
            newIpContainer.classList.remove("hidden");
            newIpContainer.classList.add("flex");

            // Проверяем, есть ли уже дополнительный инпут для новой записи
            if (!document.getElementById("extra-new-server-input")) {
              // Добавляем новый инпут для следующей записи
              const newInputHTML = `
                <div id="extra-new-server-container" class="new-server-item flex flex-col lg:flex-row gap-8">
                  <div class="flex flex-col gap-3 w-full lg:w-[264px]">
                    <label class="text-lg-regular text-text-dark-secondary">
                      NS-сервер
                    </label>
                    <input
                      type="text"
                      id="extra-new-server-input"
                      class="bg-base-surface-2 border border-base-border rounded-6 px-4 h-14 text-lg-medium text-text-dark-secondary placeholder:text-text-dark-tertiary focus:border-state-brand-active focus:outline-none transition-colors"
                      placeholder="Добавьте новую запись"
                    />
                  </div>
                  <div id="extra-new-ip-container" class="flex-col gap-3 w-full lg:w-[264px] hidden">
                    <label class="text-lg-regular text-text-dark-secondary">
                      IP-адрес
                    </label>
                    <input
                      type="text"
                      id="extra-new-ip-input"
                      class="bg-base-surface-2 border border-base-border rounded-6 px-4 h-14 text-lg-medium text-text-dark-secondary placeholder:text-text-dark-tertiary focus:border-state-brand-active focus:outline-none transition-colors"
                      placeholder="Text"
                    />
                  </div>
                </div>
              `;
              container.insertAdjacentHTML("beforeend", newInputHTML);

              // Инициализируем события для нового инпута
              initExtraNewServerInput();

              // Добавляем кнопку удаления для первого нового элемента
              addDeleteButtonToNewServer("new-server-container");
            }
          } else {
            // Скрываем поле IP-адреса если инпут пустой
            newIpContainer.classList.add("hidden");
            newIpContainer.classList.remove("flex");
          }

          // Активируем кнопку сохранения
          activateSaveButton();
        });
      }

      // Extra New Server Input Logic / Логика дополнительного инпута
      function initExtraNewServerInput() {
        const extraNewServerInput = document.getElementById(
          "extra-new-server-input"
        );
        const extraNewIpContainer = document.getElementById(
          "extra-new-ip-container"
        );

        if (extraNewServerInput) {
          extraNewServerInput.addEventListener("input", (e) => {
            const value = e.target.value.trim();

            if (value.length > 0) {
              extraNewIpContainer.classList.remove("hidden");
              extraNewIpContainer.classList.add("flex");

              // Добавляем кнопку удаления для дополнительного элемента
              addDeleteButtonToNewServer("extra-new-server-container");
            } else {
              extraNewIpContainer.classList.add("hidden");
              extraNewIpContainer.classList.remove("flex");
            }

            activateSaveButton();
          });
        }
      }

      // Add Delete Button / Добавление кнопки удаления
      function addDeleteButtonToNewServer(containerId) {
        const container = document.getElementById(containerId);
        if (!container || container.querySelector(".delete-new-server-btn")) {
          return; // Кнопка уже добавлена
        }

        // Создаем контейнер для кнопки удаления
        const deleteBtnContainer = document.createElement("div");
        deleteBtnContainer.className = "flex items-start pt-[34px]";

        const deleteBtn = document.createElement("button");
        deleteBtn.className =
          "delete-new-server-btn hover:bg-base-fill-1 p-2 rounded transition-colors";
        deleteBtn.innerHTML = `
          <img
            src="../public/icons/close.svg"
            alt="Удалить"
            class="w-4 h-4"
          />
        `;

        // Добавляем обработчик удаления
        deleteBtn.addEventListener("click", () => {
          container.remove();
          activateSaveButton();
        });

        deleteBtnContainer.appendChild(deleteBtn);
        container.appendChild(deleteBtnContainer);
      }

      // Change Detection / Обнаружение изменений
      function initChangeDetection() {
        const allInputs = document.querySelectorAll("input");
        allInputs.forEach((input) => {
          input.addEventListener("input", () => {
            activateSaveButton();
          });
        });
      }

      // Activate Save Button / Активация кнопки сохранения
      function activateSaveButton() {
        const saveBtn = document.getElementById("save-btn");
        const hasChanges = checkForChanges();

        if (hasChanges) {
          saveBtn.classList.remove(
            "bg-base-surface-2",
            "text-text-dark-tertiary",
            "cursor-not-allowed"
          );
          saveBtn.classList.add(
            "bg-state-brand-active",
            "hover:bg-state-brand-hover",
            "text-white",
            "cursor-pointer"
          );
          saveBtn.disabled = false;
        } else {
          saveBtn.classList.add(
            "bg-base-surface-2",
            "text-text-dark-tertiary",
            "cursor-not-allowed"
          );
          saveBtn.classList.remove(
            "bg-state-brand-active",
            "hover:bg-state-brand-hover",
            "text-white",
            "cursor-pointer"
          );
          saveBtn.disabled = true;
        }
      }

      // Check For Changes / Проверка наличия изменений
      function checkForChanges() {
        // Проверяем, есть ли заполненные IP поля
        const ipInputs = document.querySelectorAll(".ip-input");
        for (let input of ipInputs) {
          if (input.value.trim().length > 0) {
            return true;
          }
        }

        // Проверяем новый сервер
        const newServerInput = document.getElementById("new-server-input");
        if (newServerInput && newServerInput.value.trim().length > 0) {
          return true;
        }

        // Проверяем дополнительный новый сервер
        const extraNewServerInput = document.getElementById(
          "extra-new-server-input"
        );
        if (
          extraNewServerInput &&
          extraNewServerInput.value.trim().length > 0
        ) {
          return true;
        }

        return false;
      }

      // Save Button Handler / Обработчик кнопки сохранения
      document.addEventListener("DOMContentLoaded", function () {
        const saveBtn = document.getElementById("save-btn");
        if (saveBtn) {
          saveBtn.addEventListener("click", () => {
            if (!saveBtn.disabled) {
              console.log("Saving NS servers...");
              // Здесь будет API запрос для сохранения
              alert("NS-серверы сохранены!");
            }
          });
        }
      });
    </script>
  </body>
</html>
